<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üïâÔ∏è Shiva Abhishek ‚Äì Karma Game</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: black;
    font-family: Arial, sans-serif;
  }
  #ui {
    position: absolute;
    top: 20px;
    left: 20px;
    color: white;
    z-index: 10;
  }
  button {
    padding: 8px 12px;
    margin-top: 6px;
    font-size: 14px;
    cursor: pointer;
  }
</style>
</head>

<body>

<div id="ui">
  <h2>üïâÔ∏è Shiva Abhishek</h2>
  Karma: <span id="karma">0</span><br>
  <button onclick="pourWater()">Pour Water</button><br>
  <button onclick="toggleDayNight()">Day / Night</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>
/* ================= SCENE SETUP ================= */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x101010);

const camera = new THREE.PerspectiveCamera(
  60,
  window.innerWidth / window.innerHeight,
  0.1,
  1000
);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

/* ================= KARMA ================= */
let karma = parseInt(localStorage.getItem("karma")) || 0;
document.getElementById("karma").innerText = karma;

/* ================= LIGHTING ================= */
let isDay = true;

const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
scene.add(ambientLight);

const dirLight = new THREE.DirectionalLight(0xffffff, 1);
dirLight.position.set(5, 10, 5);
dirLight.castShadow = true;
scene.add(dirLight);

const glowLight = new THREE.PointLight(0xffffff, 0.5, 6);
glowLight.position.set(0, 3, 0);
scene.add(glowLight);

/* ================= FLOOR ================= */
const floor = new THREE.Mesh(
  new THREE.CircleGeometry(6, 64),
  new THREE.MeshStandardMaterial({ color: 0x222222 })
);
floor.rotation.x = -Math.PI / 2;
floor.receiveShadow = true;
scene.add(floor);

/* ================= SHIVA LINGAM ================= */

let wetness = 0;

const stoneMaterial = new THREE.MeshStandardMaterial({
  color: 0x0b0b0b,
  roughness: 0.35,
  metalness: 0.15,
  envMapIntensity: 1.0
});

// Lingam body
const lingamBody = new THREE.Mesh(
  new THREE.CylinderGeometry(0.85, 0.95, 2.9, 96),
  stoneMaterial
);
lingamBody.position.y = 1.45;
lingamBody.castShadow = true;
scene.add(lingamBody);

// Dome top
const lingamTop = new THREE.Mesh(
  new THREE.SphereGeometry(0.85, 96, 48),
  stoneMaterial
);
lingamTop.position.y = 2.95;
lingamTop.scale.y = 0.7;
lingamTop.castShadow = true;
scene.add(lingamTop);

/* ================= VIBHUTI STRIPES ================= */
const stripeMaterial = new THREE.MeshStandardMaterial({
  color: 0xf0f0f0,
  roughness: 0.3
});

for (let i = 0; i < 3; i++) {
  const stripe = new THREE.Mesh(
    new THREE.BoxGeometry(1.25, 0.07, 0.05),
    stripeMaterial
  );
  stripe.position.set(0, 2.4 + i * 0.18, 0.9);
  scene.add(stripe);
}

/* ================= RED TILAK ================= */
const tilak = new THREE.Mesh(
  new THREE.CircleGeometry(0.12, 32),
  new THREE.MeshStandardMaterial({ color: 0xaa0000 })
);
tilak.position.set(0, 2.6, 0.93);
scene.add(tilak);

/* ================= YONI BASE ================= */
const yoniMaterial = new THREE.MeshStandardMaterial({
  color: 0x0f0f0f,
  roughness: 0.55
});

const yoniBase = new THREE.Mesh(
  new THREE.CylinderGeometry(3.2, 3.4, 0.7, 96),
  yoniMaterial
);
yoniBase.position.y = 0.35;
yoniBase.receiveShadow = true;
scene.add(yoniBase);

// Groove
const groove = new THREE.Mesh(
  new THREE.TorusGeometry(1.6, 0.08, 16, 64),
  yoniMaterial
);
groove.rotation.x = Math.PI / 2;
groove.position.y = 0.72;
scene.add(groove);

// Spout
const spout = new THREE.Mesh(
  new THREE.BoxGeometry(1.4, 0.25, 0.6),
  yoniMaterial
);
spout.position.set(0, 0.45, 2.9);
scene.add(spout);

/* ================= COPPER VESSEL ================= */
const vessel = new THREE.Mesh(
  new THREE.SphereGeometry(0.7, 32, 32),
  new THREE.MeshStandardMaterial({
    color: 0xb87333,
    metalness: 0.8,
    roughness: 0.2
  })
);
vessel.position.set(0, 5, 0);
scene.add(vessel);

/* ================= WATER ================= */
const waterMaterial = new THREE.MeshPhysicalMaterial({
  color: 0x44aaff,
  transparent: true,
  transmission: 1,
  roughness: 0.1
});

const waterDrops = [];

function pourWater() {
  playMantra();
  wetness = 1.0;

  for (let i = 0; i < 60; i++) {
    const drop = new THREE.Mesh(
      new THREE.SphereGeometry(0.04, 8, 8),
      waterMaterial
    );
    drop.position.set(
      (Math.random() - 0.5) * 0.3,
      4.6,
      (Math.random() - 0.5) * 0.3
    );
    drop.velocity = Math.random() * 0.03 + 0.03;
    scene.add(drop);
    waterDrops.push(drop);
  }

  karma += 10;
  localStorage.setItem("karma", karma);
  document.getElementById("karma").innerText = karma;
}

/* ================= MANTRA ================= */
const mantra = new Audio("sounds/shiva_mantra.mp3");
function playMantra() {
  mantra.currentTime = 0;
  mantra.play().catch(() => {});
}

/* ================= DAY / NIGHT ================= */
function toggleDayNight() {
  isDay = !isDay;
  ambientLight.intensity = isDay ? 0.6 : 0.2;
  dirLight.intensity = isDay ? 1 : 0.3;
  scene.background.set(isDay ? 0x101010 : 0x020611);
}

/* ================= CAMERA ================= */
camera.position.set(0, 4, 8);
camera.lookAt(0, 1.6, 0);

/* ================= ANIMATION ================= */
function animate() {
  requestAnimationFrame(animate);

  waterDrops.forEach((drop, i) => {
    drop.position.y -= drop.velocity;
    drop.position.z += 0.015;
    if (drop.position.y < 0.4) {
      scene.remove(drop);
      waterDrops.splice(i, 1);
    }
  });

  wetness = Math.max(0, wetness - 0.005);
  stoneMaterial.roughness = 0.35 - wetness * 0.25;

  lingamBody.rotation.y += 0.0003;
  lingamTop.rotation.y += 0.0003;

  renderer.render(scene, camera);
}
animate();

/* ================= RESIZE ================= */
window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
